# ğŸ”§ æŠ€æœ¯å®ç°æŒ‡å—

## ğŸ“‹ æ ¸å¿ƒæŠ€æœ¯æ ˆ
- **BlockNote**: 0.39.1 - åŸºç¡€ç¼–è¾‘å™¨æ¡†æ¶
- **React**: 18+ - UIæ¡†æ¶  
- **KaTeX**: 0.16.22 - æ•°å­¦å…¬å¼æ¸²æŸ“
- **TypeScript**: 5.4.5 - ç±»å‹å®‰å…¨

## ğŸ—ï¸ æ¶æ„è®¾è®¡

### ç»„ä»¶ç»“æ„
```
TrueInlineMathV2Editor/
â”œâ”€â”€ InlineMathComponent     # è¡Œå†…å…¬å¼æ¸²æŸ“ç»„ä»¶
â”œâ”€â”€ inlineMathSpec         # BlockNoteè¡Œå†…å†…å®¹è§„èŒƒ
â”œâ”€â”€ schema                 # æ‰©å±•çš„ç¼–è¾‘å™¨æ¨¡å¼
â””â”€â”€ æ™ºèƒ½äº¤äº’é€»è¾‘            # å¿«æ·é”®å’Œè½¬æ¢é€»è¾‘
```

### å…³é”®APIå®ç°
```typescript
// 1. è¡Œå†…å…¬å¼è§„èŒƒå®šä¹‰
const inlineMathSpec = createReactInlineContentSpec(
  {
    type: "inlineMath",
    propSchema: { latex: { default: "" } },
    content: "none",
  },
  { render: InlineMathComponent }
);

// 2. Schemaæ‰©å±•
const schema = BlockNoteSchema.create({
  blockSpecs: { ...defaultBlockSpecs, math: mathBlockSpec() },
  inlineContentSpecs: { ...defaultInlineContentSpecs, inlineMath: inlineMathSpec }
});

// 3. æ™ºèƒ½å¿«æ·é”®å¤„ç†
const handleKeyDown = useCallback((event: KeyboardEvent) => {
  if ((event.ctrlKey || event.metaKey) && event.shiftKey && event.key.toLowerCase() === 'e') {
    event.preventDefault();
    const selectedText = getSelection()?.toString().trim();
    
    if (selectedText) {
      // è½¬æ¢é€‰ä¸­æ–‡æœ¬ä¸ºè¡Œå†…å…¬å¼
      convertTextToInlineMath(selectedText);
    } else {
      // æ‰“å¼€è¾“å…¥å¯¹è¯æ¡†
      openMathInputDialog();
    }
  }
}, [editor]);
```

## ğŸ¯ å®ç°è¦ç‚¹

### 1. è¡Œå†…å…¬å¼æ¸²æŸ“
- ä½¿ç”¨ `createReactInlineContentSpec` åˆ›å»ºè¡Œå†…å†…å®¹è§„èŒƒ
- å®ç°ç‚¹å‡»ç¼–è¾‘ã€é”®ç›˜å¯¼èˆªã€è‡ªåŠ¨ä¿å­˜
- KaTeXæ¸²æŸ“ï¼Œæ”¯æŒé”™è¯¯å¤„ç†

### 2. æ™ºèƒ½æ–‡æœ¬è½¬æ¢
- æ£€æµ‹æ–‡æœ¬é€‰æ‹©çŠ¶æ€
- è°ƒç”¨ `insertInlineContent` API æ’å…¥è¡Œå†…å…¬å¼
- æä¾›å›é€€æœºåˆ¶ç¡®ä¿åŠŸèƒ½ç¨³å®š

### 3. SSRå…¼å®¹æ€§
```typescript
// å…³é”®ï¼šæ‰€æœ‰windowå¯¹è±¡ä½¿ç”¨éƒ½éœ€è¦æ£€æŸ¥
const selection = typeof window !== 'undefined' ? window.getSelection() : null;
```

### 4. æ ·å¼é›†æˆ
```typescript
import "@blocknote/core/style.css";
import "@blocknote/mantine/style.css";  // æ³¨æ„ï¼šä¸æ˜¯ /dist/style.css
import "katex/dist/katex.min.css";
```

## ğŸš¨ å…³é”®é—®é¢˜è§£å†³

### ç±»å‹å®‰å…¨
- æœ€å°åŒ– `as any` ä½¿ç”¨ï¼Œä»…åœ¨å¿…è¦çš„ç±»å‹æ–­è¨€å¤„ä½¿ç”¨
- ä¿æŒä¸šåŠ¡é€»è¾‘çš„å®Œæ•´ç±»å‹æ£€æŸ¥

### ç¼“å­˜é—®é¢˜  
- Next.jsç¼“å­˜å¯èƒ½å¯¼è‡´ä¿®æ”¹ä¸ç”Ÿæ•ˆ
- å¿…è¦æ—¶æ¸…é™¤ `.next` ç›®å½•é‡æ–°ç¼–è¯‘

### APIç†è§£
- BlockNoteè¡Œå†…å†…å®¹APIä¸å—å†…å®¹APIå®Œå…¨ä¸åŒ
- éœ€è¦æ·±å…¥ç†è§£ `createReactInlineContentSpec` çš„æ­£ç¡®ç”¨æ³•

## ğŸ“¦ é›†æˆæ–¹å¼

### å®Œæ•´ç»„ä»¶ä½¿ç”¨
```tsx
import { TrueInlineMathV2Editor } from './components/TrueInlineMathV2Editor';

function App() {
  return <TrueInlineMathV2Editor onChange={handleChange} />;
}
```

### æ‰‹åŠ¨é›†æˆ
```tsx
import { BlockNoteSchema, defaultBlockSpecs, defaultInlineContentSpecs } from "@blocknote/core";
import { useCreateBlockNote } from "./hooks/useCreateBlockNote";

// åˆ›å»ºè‡ªå®šä¹‰schema
const schema = BlockNoteSchema.create({
  blockSpecs: { ...defaultBlockSpecs, math: mathBlockSpec() },
  inlineContentSpecs: { ...defaultInlineContentSpecs, inlineMath: inlineMathSpec }
});

// ä½¿ç”¨è‡ªå®šä¹‰ç¼–è¾‘å™¨
const editor = useCreateBlockNote({ schema });
```

---

**æŠ€æœ¯æ€»ç»“**: æˆåŠŸçªç ´äº†BlockNoteè¡Œå†…å†…å®¹æ‰©å±•çš„æŠ€æœ¯éš¾ç‚¹ï¼Œå»ºç«‹äº†å®Œæ•´å¯å¤ç”¨çš„æ•°å­¦å…¬å¼æ‰©å±•æ¶æ„ã€‚